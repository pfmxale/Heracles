<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Terminal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightweight-charts/4.1.1/lightweight-charts.standalone.production.js"></script>
    <style>
        /* Styling wie in deinem Originalcode */
        body { margin: 0; padding: 20px; font-family: sans-serif; background-color: #1e222d; color: #ffffff; }
        .container { display: grid; grid-template-columns: 300px 1fr; gap: 20px; height: 100vh; }
        .quote-monitor, .chart-container { background-color: #131722; padding: 15px; border-radius: 4px; }
        .chart-container { height: 600px; position: relative; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 8px; text-align: right; border-bottom: 1px solid #2a2e39; }
        th { background-color: #2a2e39; text-align: left; }
        .positive { color: #26a69a; } .negative { color: #ff4976; }
        #tickerInput { width: 100%; padding: 8px; margin-bottom: 15px; background-color: #2a2e39; color: white; border: 1px solid #363c4e; border-radius: 4px; }
        .error { color: #ff4976; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="quote-monitor">
            <input type="text" id="tickerInput" placeholder="Symbol eingeben... (z.B. AAPL)">
            <div id="errorMessage" class="error"></div>
            <div id="quoteResult" class="quote-result">
                <div id="quoteSymbol" class="quote-symbol"></div>
                <div id="quotePrice" class="quote-price"></div>
                <div id="quoteChange" class="quote-change"></div>
            </div>
            <table>
                <thead>
                    <tr><th>Symbol</th><th>Preis</th><th>Chg %</th><th>Vol</th></tr>
                </thead>
                <tbody id="stockList"></tbody>
            </table>
        </div>
        <div class="chart-container" id="chart">
            <div id="loading" class="loading">Laden...</div>
        </div>
    </div>

    <script>
        const API_KEY = 'H0TXRFYO7L6D06KU';
        let watchlist = new Set(['AAPL', 'MSFT', 'GOOGL', 'AMZN']);

        const chartContainer = document.getElementById('chart');
        const chart = LightweightCharts.createChart(chartContainer, {
            layout: { background: { color: '#131722' }, textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#2a2e39' }, horzLines: { color: '#2a2e39' } },
            timeScale: { borderColor: '#2a2e39' },
            rightPriceScale: { borderColor: '#2a2e39' }
        });

        const candleSeries = chart.addCandlestickSeries();

        async function fetchQuote(symbol) {
            try {
                const response = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${API_KEY}`);
                const data = await response.json();
                const quote = data['Global Quote'];
                if (!quote) throw new Error('Symbol nicht gefunden');
                return {
                    symbol: quote['01. symbol'],
                    price: parseFloat(quote['05. price']),
                    change: parseFloat(quote['09. change']),
                    changePercent: parseFloat(quote['10. change percent'].replace('%', '')),
                    volume: parseInt(quote['06. volume'], 10)
                };
            } catch (error) {
                throw new Error('Fehler beim Abrufen des Symbols');
            }
        }

        async function fetchChartData(symbol) {
            try {
                const response = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${API_KEY}`);
                const data = await response.json();
                const timeSeries = data['Time Series (Daily)'];
                if (!timeSeries) throw new Error('Chart-Daten nicht verfügbar');
                const chartData = Object.keys(timeSeries).map(date => ({
                    time: date,
                    open: parseFloat(timeSeries[date]['1. open']),
                    high: parseFloat(timeSeries[date]['2. high']),
                    low: parseFloat(timeSeries[date]['3. low']),
                    close: parseFloat(timeSeries[date]['4. close'])
                })).reverse();
                candleSeries.setData(chartData);
            } catch (error) {
                console.error(error.message);
            }
        }

        async function updateQuoteDisplay(symbol) {
            try {
                const quote = await fetchQuote(symbol);
                document.getElementById('quoteSymbol').textContent = quote.symbol;
                document.getElementById('quotePrice').textContent = `Preis: ${quote.price.toFixed(2)}`;
                const changeClass = quote.changePercent >= 0 ? 'positive' : 'negative';
                document.getElementById('quoteChange').textContent = `Änderung: ${quote.changePercent.toFixed(2)}%`;
                document.getElementById('quoteChange').className = changeClass;
                fetchChartData(symbol);
            } catch (error) {
                document.getElementById('errorMessage').textContent = error.message;
            }
        }

        document.getElementById('tickerInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') {
                const symbol = e.target.value.toUpperCase();
                if (symbol) updateQuoteDisplay(symbol);
            }
        });

        // Watchlist aktualisieren
        async function loadWatchlist() {
            const stockList = document.getElementById('stockList');
            stockList.innerHTML = '';
            for (const symbol of watchlist) {
                try {
                    const quote = await fetchQuote(symbol);
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${quote.symbol}</td><td>${quote.price.toFixed(2)}</td><td>${quote.changePercent.toFixed(2)}%</td><td>${quote.volume}</td>`;
                    stockList.appendChild(row);
                } catch (error) {
                    console.error(`Fehler bei ${symbol}:`, error.message);
                }
            }
        }

        loadWatchlist();
    </script>
</body>
</html>
