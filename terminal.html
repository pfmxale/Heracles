<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Stock Terminal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightweight-charts/4.1.1/lightweight-charts.standalone.production.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #1e222d;
            color: #ffffff;
        }

        .container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            height: 100vh;
        }

        .quote-monitor {
            background-color: #131722;
            padding: 15px;
            border-radius: 4px;
        }

        .chart-container {
            background-color: #131722;
            padding: 15px;
            border-radius: 4px;
            height: 600px;
            position: relative;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th, td {
            padding: 8px;
            text-align: right;
            border-bottom: 1px solid #2a2e39;
        }

        th {
            background-color: #2a2e39;
            text-align: left;
        }

        th:not(:first-child) {
            text-align: right;
        }

        .negative {
            color: #ff4976;
        }

        .positive {
            color: #26a69a;
        }

        #tickerInput {
            width: calc(100% - 16px);
            padding: 8px;
            margin-bottom: 15px;
            background-color: #2a2e39;
            border: 1px solid #363c4e;
            color: white;
            border-radius: 4px;
        }

        .quote-result {
            background-color: #1e222d;
            border: 1px solid #2a2e39;
            padding: 15px;
            margin-top: 10px;
            border-radius: 4px;
            display: none;
        }

        .quote-result.active {
            display: block;
        }

        .quote-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .quote-symbol {
            font-size: 18px;
            font-weight: bold;
        }

        .quote-price {
            font-size: 24px;
            margin: 10px 0;
        }

        .quote-change {
            font-size: 16px;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            display: none;
        }

        .error {
            color: #ff4976;
            padding: 10px;
            margin-top: 10px;
            background-color: rgba(255, 73, 118, 0.1);
            border-radius: 4px;
            display: none;
        }

        .clickable {
            cursor: pointer;
        }

        .clickable:hover {
            background-color: #2a2e39;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="quote-monitor">
            <input type="text" id="tickerInput" placeholder="Symbol eingeben... (z.B. AAPL)">
            <div id="errorMessage" class="error"></div>
            <div id="quoteResult" class="quote-result">
                <div class="quote-header">
                    <span id="quoteSymbol" class="quote-symbol"></span>
                    <span id="quoteVolume"></span>
                </div>
                <div id="quotePrice" class="quote-price"></div>
                <div id="quoteChange" class="quote-change"></div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Preis</th>
                        <th>Chg %</th>
                        <th>Vol</th>
                    </tr>
                </thead>
                <tbody id="stockList">
                </tbody>
            </table>
        </div>
        <div class="chart-container" id="chart">
            <div id="loading" class="loading">Laden...</div>
        </div>
    </div>

    <script>
        const API_HOST = 'enclout-yahoo-finance.p.rapidapi.com';
        const API_KEY = 'f8d8515321msh5962f03ad4bb432p1294c5jsn10b6a5493c8d';

        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            layout: {
                background: { color: '#131722' },
                textColor: '#d1d4dc',
            },
            grid: {
                vertLines: { color: '#2a2e39' },
                horzLines: { color: '#2a2e39' },
            },
            rightPriceScale: {
                borderColor: '#2a2e39',
            },
            timeScale: {
                borderColor: '#2a2e39',
            },
        });

        const candleSeries = chart.addCandlestickSeries();

        async function fetchQuote(symbol) {
            try {
                const response = await fetch(
                    `https://${API_HOST}/show.json?text=${encodeURIComponent(symbol)}`,
                    {
                        method: 'GET',
                        headers: {
                            'x-rapidapi-host': API_HOST,
                            'x-rapidapi-key': API_KEY,
                        },
                    }
                );

                const data = await response.json();
                if (data && data[0]) {
                    const stock = data[0];
                    return {
                        symbol: stock.symbol,
                        price: parseFloat(stock.last_trade_price_only),
                        change: parseFloat(stock.change),
                        changePercent: parseFloat(stock.change_in_percent.replace('%', '')),
                        volume: stock.volume,
                    };
                }
                throw new Error('Keine Daten verfÃ¼gbar');
            } catch (error) {
                throw error;
            }
        }

        async function updateQuoteDisplay(symbol) {
            try {
                const quote = await fetchQuote(symbol);

                const quoteSymbol = document.getElementById('quoteSymbol');
                const quotePrice = document.getElementById('quotePrice');
                const quoteChange = document.getElementById('quoteChange');
                const quoteVolume = document.getElementById('quoteVolume');

                quoteSymbol.textContent = quote.symbol;
                quotePrice.textContent = quote.price.toFixed(2);
                quoteChange.textContent = `${quote.changePercent >= 0 ? '+' : ''}${quote.changePercent.toFixed(2)}% (${quote.change.toFixed(2)})`;
                quoteVolume.textContent = `Vol: ${quote.volume}`;

                quoteChange.className = `quote-change ${quote.changePercent >= 0 ? 'positive' : 'negative'}`;
                document.getElementById('quoteResult').classList.add('active');
            } catch (error) {
                const errorMessage = document.getElementById('errorMessage');
                errorMessage.textContent = 'Fehler beim Laden der Daten: ' + error.message;
                errorMessage.style.display = 'block';
            }
        }

        document.getElementById('tickerInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const symbol = e.target.value.trim();
                if (symbol) {
                    updateQuoteDisplay(symbol);
                }
            }
        });
    </script>
</body>
</html>
